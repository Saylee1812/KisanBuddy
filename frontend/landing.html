<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>KisanBuddy</title>
    <script src="js/auth_check.js"></script>
    <script>
      const token = localStorage.getItem("token");
      if (!token) {
        window.location.href = "pre_land.html";
      }
    </script>
    <link rel="stylesheet" href="css/style.css" />
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="css/style1.css" />
    <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.4/css/all.min.css"
  />
  </head>

  <body>

    <div id="chatbot-btn" onclick="openChatbot()">
      <i class="fas fa-robot"></i>
    </div>

    <!-- Chatbot Popup -->
    <div id="chatbot-popup">
      <div id="chatbot-header">
        Chatbot
        <span onclick="closeChatbot()">‚úñ</span>
      </div>
      <div id="chatbot-body"></div>
      <div id="chatbot-input">
        <input type="text" id="user-input" placeholder="Type your message..." />
        <button onclick="sendMessage()">Send</button>
      </div>
    </div>

    <!-- Chatbot CSS -->
    <style>
      #chatbot-btn {
        position: fixed;
        bottom: 25px;
        right: 25px;
        background-color: #0077ff;
        color: white;
        padding: 15px;
        border-radius: 50%;
        cursor: pointer;
        font-size: 22px;
        box-shadow: 0 4px 8px rgba(0,0,0,0.3);
        z-index: 1000;
      }

      #chatbot-popup {
        display: none;
        position: fixed;
        bottom: 90px;
        right: 25px;
        width: 350px;
        height: 450px;
        background: white;
        border-radius: 12px;
        box-shadow: 0 8px 20px rgba(0,0,0,0.3);
        z-index: 1000;
        flex-direction: column;
        overflow: hidden;
      }

      #chatbot-header {
        background: #0077ff;
        color: white;
        padding: 12px;
        font-weight: bold;
        display: flex;
        justify-content: space-between;
        align-items: center;
      }

      #chatbot-body {
        flex: 1;
        padding: 12px;
        overflow-y: auto;
      }

      #chatbot-input {
        display: flex;
        border-top: 1px solid #ccc;
      }

      #chatbot-input input {
        flex: 1;
        padding: 10px;
        border: none;
        outline: none;
      }

      #chatbot-input button {
        padding: 10px 20px;
        background: #0077ff;
        color: white;
        border: none;
        cursor: pointer;
      }

      .message {
        margin-bottom: 10px;
      }

      .user {
        text-align: right;
        color: #0077ff;
      }

      .bot {
        text-align: left;
        color: #333;
      }

      body.dark-mode .home {
        background: #1e1e1e;
      }
    </style>

    <!-- Chatbot JavaScript -->
    <script>
      function openChatbot() {
        document.getElementById('chatbot-popup').style.display = 'flex';
        if (document.getElementById('chatbot-body').innerText.trim() === '') {
          appendMessage('bot', 'Hi! I\'m your KisanBuddy Assistant üåæ. Ask me anything!');
        }
      }

      function closeChatbot() {
        document.getElementById('chatbot-popup').style.display = 'none';
      }

      function appendMessage(sender, text) {
        const msg = document.createElement('div');
        msg.className = `message ${sender}`;
        msg.innerHTML = text;
        document.getElementById('chatbot-body').appendChild(msg);
        document.getElementById('chatbot-body').scrollTop = document.getElementById('chatbot-body').scrollHeight;
      }

      async function sendMessage() {
        const input = document.getElementById('user-input');
        const message = input.value.trim();
        if (!message) return;

        appendMessage('user', message);
        input.value = '';

        appendMessage('bot', 'Typing...');

        try {
          const token = localStorage.getItem('token');
          const userId = localStorage.getItem('user_id');

          const res = await fetch('http://127.0.0.1:8000/chat', {
            method: 'POST',
            headers: {
              'Authorization': `Bearer ${token}`,
              'Content-Type': 'application/json'
            },
            body: JSON.stringify({
              message: message,
              user_id: userId
            })
          });

          const data = await res.json();
          document.querySelector('#chatbot-body .bot:last-child').remove();

          if (res.ok) {
            const botMessage = typeof data.response === 'string' ? data.response : JSON.stringify(data.response, null, 2);
            appendMessage('bot', botMessage);
          } else {
            appendMessage('bot', data.detail || 'Something went wrong.');
          }
        } catch (err) {
          console.error('Fetch error:', err);
          document.querySelector('#chatbot-body .bot:last-child').remove();
          appendMessage('bot', 'Server connection failed.');
        }
      }
    </script>

    <!-- navbar section -->
    <header class="header">
      <div class="logo"><h1>KisanBuddy</h1></div>
      <nav class="navbar" id="navbar">
        <a href="#home">Home</a>
        <a href="#features">Features</a>
        <a href="#about">About</a>
        <a href="#footer">Contact</a>
        <a href="login.html" target="_blank">Login</a>
        <a href="signup.html" target="_blank">Signup</a>
        <a href="guide/index.html">EXPLORE NOW</a>
        <div class="language-selector">
          <select id="languageDropdown" onchange="handleLanguageChange()">
            <option value="en">üåê English</option>
            <option value="hi">‡§π‡§ø‡§®‡•ç‡§¶‡•Ä</option>
            <option value="mr">‡§Æ‡§∞‡§æ‡§†‡•Ä</option>
            <option value="ta">‡Æ§‡ÆÆ‡Æø‡Æ¥‡Øç</option>
            <option value="te">‡∞§‡±Ü‡∞≤‡±Å‡∞ó‡±Å</option>
            <option value="kn">‡≤ï‡≤®‡≥ç‡≤®‡≤°</option>
          </select>
        </div>
        <a href="profile.html" class="btn">Profile</a>
      </nav>

      <div id="google_translate_element" style="display: none;"></div>
      <div class="menu-toggle">
        <i class="fas fa-bars" id="menu-btn"></i>
        <label class="switch">
          <input type="checkbox" id="dark-toggle" />
          <span class="slider round"></span>
        </label>
      </div>
    </header>

    <!-- home section -->
    <section class="home" id="home">
      <div class="content">
        <h1>YOUR DIGITAL FARMING PARTNER</h1>
        <p>Empowering Farmers with Smart Insights via KisanBuddy!</p> 
      </div>
    </section>

    <!-- features section -->
    <section class="features" id="features">
      <div class="heading">
        <h1>What KisanBuddy Offers</h1>
        <p>
          KisanBuddy equips farmers with intelligent tools to elevate agricultural practices. From tailored crop recommendations and real-time weather tracking to image-based plant disease detection‚Äîour platform is designed to simplify decision-making and improve productivity. Plan, protect, and prosper with precision.
        </p>
      </div>

      <div class="card-grid">
        <div class="feature-card">
          <img src="images/rainfall.jpg" alt="Weather Forecast">
          <h3>Weather Intelligence</h3>
          <p>Stay one step ahead with accurate weather forecasts. Monitor temperature, rainfall trends, and humidity in real-time. Seamlessly integrated with crop insights, this feature ensures your farming decisions are backed by reliable environmental data.</p>
          <a href="rainfall.html" class="all-btn">More Info</a>
        </div>

        <div class="feature-card">
          <img src="images/crop.jpg" alt="Smart Crop Planning">
          <h3>Data-Driven Crop Planning</h3>
          <p>Leverage advanced data models to find the most suitable crops for your region. AgriSens analyzes key variables like soil quality and climate to guide your cultivation choices, helping you optimize yield and resource use.</p>
          <a href="crop_predict.html" class="all-btn">More Info</a>
        </div>

        <div class="feature-card">
          <img src="images/plant_disease.jpg" alt="Plant Disease Detection">
          <h3>Detect Crop Diseases Instantly</h3>
          <p>Upload images of affected plants and let AgriSens identify potential diseases using smart image analysis. Fast diagnosis means faster treatment‚Äîprotect your crops and maximize harvest quality.</p>
          <a href="disease_predict.html" class="all-btn">More Info</a>
        </div>

        <div class="feature-card">
          <img src="images/soil.jpg" alt="Soil Fertility Detection">
          <h3>Soil Fertility Detection</h3>
          <p>Assess your soil's nutrient profile and fertility level with precision. KisanBuddy analyzes key parameters to help determine soil health, enabling informed decisions for sustainable and productive farming.</p>
          <a href="soil_health.html" class="all-btn">More Info</a>
        </div>

        <div class="feature-card">
          <img src="images/assistance.jpg" alt="Smart Farming Guide">
          <h3>Step-by-Step Farming Assistance</h3>
          <p>Get personalized growing plans with our Smart Farming Guide. It includes sowing schedules, growth stage tracking, watering reminders, fertilizer advice, pest alerts, and harvest timing‚Äîall in one place.</p>
          <a href="guide/index.html" class="all-btn">More Info</a>
        </div>
      </div>
    </section>

    <!-- about section -->
    <section class="about" id="about">
      <div class="heading">
        <h1>About KisanBuddy</h1>
        <p>KisanBuddy is your all-in-one digital farming companion. Designed to support Indian farmers with real-time insights, our platform integrates advanced technologies to simplify crop planning, monitor soil and weather conditions, detect diseases, and offer step-by-step farming guidance.</p>
      </div>

      <div class="about-content">
        <div class="about-text">
          <h3>Our Mission</h3>
          <p>Empower farmers with accessible technology and data-driven tools that enhance productivity, sustainability, and resilience in agriculture.</p>

          <h3>Who We Serve</h3>
          <p>From smallholders to agri-entrepreneurs, KisanBuddy serves anyone seeking to make informed agricultural decisions with ease and confidence.</p>
        </div>
        <div class="about-image">
          <img src="images/smart_farming.jpg" alt="Smart Farming" />
        </div>
      </div>
    </section>

    <!-- footer section -->
    <section class="footer" id="footer">
      <div class="box-container">
        <div class="box">
          <h3>quick links</h3>
          <a href="#home"><i class="fas fa-chevron-right"></i>home</a>
          <a href="#features"><i class="fas fa-chevron-right"></i>features</a>
          <a href="#about"><i class="fas fa-chevron-right"></i>about</a>
        </div>

        <div class="box">
          <h3>extra links</h3>
          <a href="#"><i class="fas fa-chevron-right"></i>ask questions</a>
          <a href="#"><i class="fas fa-chevron-right"></i>terms of use</a>
          <a href="#"><i class="fas fa-chevron-right"></i>privacy policy</a>
        </div>

        <div class="box">
          <h3>Helpful Resources</h3>
          <a href="#"><i class="fas fa-chevron-right"></i> FAQs</a>
          <a href="#"><i class="fas fa-chevron-right"></i> User Guides</a>
          <a href="#"><i class="fas fa-chevron-right"></i> Support Center</a>
        </div>

        <div class="box">
          <h3>Stay Connected</h3>
          <a href="#"><i class="fas fa-chevron-right"></i> Future Scope</a>
          <a href="#"><i class="fas fa-chevron-right"></i> Community Forum</a>
          <a href="#"><i class="fas fa-chevron-right"></i> Newsletter</a>
        </div>
      </div>
    </section>

    <!-- Scripts -->


    <script>
      document.getElementById("menu-btn").addEventListener("click", () => {
        document.getElementById("navbar").classList.toggle("active");
      });

      const darkToggle = document.getElementById("dark-toggle");
      const body = document.body;

      darkToggle.addEventListener("change", () => {
        body.classList.toggle("dark-mode");
        localStorage.setItem("darkMode", body.classList.contains("dark-mode"));
      });

      window.onload = () => {
        if (localStorage.getItem("darkMode") === "true") {
          body.classList.add("dark-mode");
          darkToggle.checked = true;
        }
      };

      const featureButtons = document.querySelectorAll(".buttonn, .home-btn");
      featureButtons.forEach(button => {
        button.addEventListener("click", e => {
          const token = localStorage.getItem("token");
          if (!token) {
            e.preventDefault();
            alert("Please login or signup to access features.");
          }
        });
      });
    </script>
     <script src="js/main.js"></script>
     <script src="js/translate.js"></script>
  </body>
</html>
